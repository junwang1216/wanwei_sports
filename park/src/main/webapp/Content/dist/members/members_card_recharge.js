!function(e){var r={init:function(){this.initEvents()},calculateRechargeMoney:function(){var r=e("#recharge_money"),t=e("#recharge_send"),a=parseFloat(r.val()||"0.00"),i=parseFloat(t.val()||"0.00");return(a+i).toFixed(2)},initEvents:function(){var r=this;e("#keywords").autosuggest({url:"/member/searchMember",method:"post",queryParamName:"search",dataCallback:function(r){var t=r.data,a=[];if(1==r.code){if(t&&t.members&&t.members.length>0){for(var i=0;i<t.members.length;i++)a.push({id:t.members[i].memberId,label:t.members[i].cardNo,value:t.members[i].memberName+"("+t.members[i].memberMobile+","+t.members[i].cardNo+")"});return a}return e.tipsWarningAlert("没有搜索到会员"),[]}return e.logConsole("搜索会员失败",r.message),e.tipsWarningAlert("搜索会员失败"),[]},onSelect:function(r){var t=r.data("label");e("#card_no").val(t),location.assign("/member/getMembersCardRecharge?cardNo="+t)}}),e(".member-card-filter").on("click",function(r){r.preventDefault();var t=e("#member_card_form"),a=t.serialize();return!!t.valid()&&void e.post("member/searchMember",a,function(r){var t=r.data;1==r.code?t&&t.members&&t.members.length>0?location.assign("/member/getMembersCardRecharge?cardNo="+t.members[0].cardNo):e.tipsWarningAlert("没有搜索到会员"):(e.logConsole("搜索会员失败",r.message),e.tipsWarningAlert("搜索会员失败"))})}),e("#recharge_money, #recharge_send").on("change",function(t){t.preventDefault(),e(".recharge-total-money").text(r.calculateRechargeMoney())}),e(".recharge-card-submit").on("click",function(r){r.preventDefault();var t=e(this).button("loading"),a=e("#recharge_card_form"),i=a.serialize();return""===e("#recharge_cardId").val()?(e.tipsWarningAlert("请先选择会员卡"),!1):!("submitting"==a.attr("submitting")||!a.valid())&&(a.attr("submitting","submitting"),void e.post("/member/memberCardCZ",i,function(r){a.attr("submitting",""),1==r.code?(e("#invoice_confirm_modal").modal({backdrop:!1,show:!0}),e.each(r.data,function(r,t){e("#member_card_ticket_form").find("input[name='"+r+"']").val(t)}),e("#member_card_ticket_form").find("#ticket_header").val(""),e("#member_card_ticket_form").find("#ticket_money").val(""),e("#member_card_ticket_form").find("#ticket_content").val(""),e("#member_card_ticket_form").find("#invoice_no").val(r.data.balanceNo)):(e.logConsole("会员充值失败",r.message),e.tipsWarningAlert("会员充值失败")),t.button("reset")}))}),e("#is_print_ticket").on("change",function(r){r.preventDefault();var t=e(this).prop("checked");t?e(".is-show-ticket").show():e(".is-show-ticket").hide()}),e(".print-ticket").on("click",function(r){if(r.preventDefault(),!e("#is_print_ticket").prop("checked"))return location.reload(),e("#invoice_confirm_modal").modal("hide"),!1;var t=e("#member_card_ticket_form"),a=t.serialize();return!("submitting"==t.attr("submitting")||!t.valid())&&(t.attr("submitting","submitting"),void e.post("/member/saveInvoice",a,function(r){t.attr("submitting",""),1==r.code?(location.reload(),e("#invoice_confirm_modal").modal("hide")):(e.logConsole("发票登记失败",r.message),e.tipsWarningAlert("发票登记失败"))}))}),e("#recharge_type").on("change",function(r){r.preventDefault();var t=e(this);5==t.val()?e(".recharge-check-no").show():e(".recharge-check-no").hide()})}};r.init()}(jQuery);