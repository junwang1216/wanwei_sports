!function(e){var r={init:function(){this.initEvents()},calculateRechargeMoney:function(){var r=e("#recharge_money"),t=e("#recharge_send"),a=parseFloat(r.val()||"0.00"),i=parseFloat(t.val()||"0.00");return(a+i).toFixed(2)},initEvents:function(){var r=this;e("#keywords").autosuggest({url:"/member/searchMember",method:"post",queryParamName:"search",dataCallback:function(e){var r=e.data,t=[];if(1==e.code){if(r&&r.members&&r.members.length>0){for(var a=0;a<r.members.length;a++)t.push({id:r.members[a].memberId,label:r.members[a].cardNo,value:r.members[a].memberName+"("+r.members[a].memberMobile+","+r.members[a].cardNo+")"});return t}return alert("没有搜索到会员"),[]}return alert("搜索会员失败, 请稍后重试"),[]},onSelect:function(r){var t=r.data("label");e("#card_no").val(t),location.assign("/member/getMembersCardRecharge?cardNo="+t)}}),e(".member-card-filter").on("click",function(r){r.preventDefault();var t=e("#member_card_form"),a=t.serialize();return!!t.valid()&&void e.post("member/searchMember",a,function(e){var r=e.data;1==e.code?r&&r.members&&r.members.length>0?location.assign("/member/getMembersCardRecharge?cardNo="+r.members[0].cardNo):alert("没有搜索到会员"):alert("搜索会员失败, 请稍后重试")})}),e("#recharge_money, #recharge_send").on("change",function(t){t.preventDefault(),e(".recharge-total-money").text(r.calculateRechargeMoney())}),e(".recharge-card-submit").on("click",function(r){r.preventDefault();var t=e("#recharge_card_form"),a=t.serialize();return""===e("#recharge_cardId").val()?(alert("请先选择会员卡"),!1):!("submitting"==t.attr("submitting")||!t.valid())&&(t.attr("submitting","submitting"),void e.post("/member/memberCardCZ",a,function(r){t.attr("submitting",""),1==r.code?(e("#rechargeModal").modal({backdrop:!1,show:!0}),setTimeout(function(){e("#rechargeModal").modal("hide"),e("#invoice_confirm_modal").modal({backdrop:!1,show:!0}),e.each(r.data,function(r,t){e("#member_card_ticket_form").find("input[name='"+r+"']").val(t)}),e("#member_card_ticket_form").find("#ticket_header").val(e("#member_name").val()),e("#member_card_ticket_form").find("#ticket_money").val(e("#recharge_money").val()),e("#member_card_ticket_form").find("#ticket_content").val("会员卡充值")},3e3)):(console.log(r.message||"会员充值失败, 请稍后重试"),alert(r.message||"会员充值失败, 请稍后重试"))}))}),e("#is_print_ticket").on("change",function(r){r.preventDefault();var t=e(this).prop("checked");t?e(".is-show-ticket").show():e(".is-show-ticket").hide()}),e(".print-ticket").on("click",function(r){if(r.preventDefault(),!e("#is_print_ticket").prop("checked"))return location.reload(),e("#invoice_confirm_modal").modal("hide"),!1;var t=e("#member_card_ticket_form"),a=t.serialize();return!("submitting"==t.attr("submitting")||!t.valid())&&(t.attr("submitting","submitting"),void e.post("/member/saveInvoice",a,function(r){t.attr("submitting",""),1==r.code?(location.reload(),e("#invoice_confirm_modal").modal("hide")):alert(r.message||"发票登记失败, 请稍后重试")}))})}};r.init()}(jQuery);