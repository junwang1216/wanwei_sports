!function(e){var t={init:function(){this.initEvents(),e.datetimepicker.setLocale("zh"),e("#member_birthday").datetimepicker({timepicker:!1,lang:"zh",format:"Y-m-d",defaultDate:new Date}),e(".member-birthday-select").on("click",function(t){t.preventDefault(),e("#member_birthday").datetimepicker("show")}),this.getNewCardNo()},getNewCardNo:function(){e.post("member/getNewCardNo",function(t){var r=t.data;1==t.code?e("#newCardNo").val(r.newCardNo):(e.logConsole("新会员卡号生成失败",t.message),e.tipsWarningAlert("新会员卡号生成失败"))},"json")},calculateRechargeMoney:function(){var t=e("#recharge_money"),r=e("#recharge_send"),n=parseFloat(t.val()||"0.00"),a=parseFloat(r.val()||"0.00");return(n+a).toFixed(2)},calculateRefreshMoney:function(){var t=e("#refresh_money"),r=e("#refresh_send"),n=parseFloat(t.val()||"0.00"),a=parseFloat(r.val()||"0.00");return(n+a).toFixed(2)},initEvents:function(){function t(t){e.post("member/getMemberCarType",{cardTypeId:t},function(t){var r=t.data;1==t.code?(e("#upgrade_cost").val(r.cardTypeMoney),e("#upgrade_discount").val(r.cardTypeDiscount),e("#upgrade_deadline").val(r.cardDeadline)):(e.logConsole("卡类型信息查询失败",t.message),e.tipsWarningAlert("卡类型信息查询失败"))})}var r=this;e(".refresh-modal").on("click",function(t){t.preventDefault();var r=e(this).button("loading"),n=e("#member_form"),a=n.serialize();return!("submitting"==n.attr("submitting")||!n.valid())&&(n.attr("submitting","submitting"),void e.post("/member/saveMember",a,function(t){n.attr("submitting",""),1==t.code?e.tipsSuccessAlert("会员信息更新成功！"):(e.logConsole("会员信息更新失败",t.message),e.tipsWarningAlert("会员信息更新失败")),r.button("reset")}))}),e("#recharge_type").on("change",function(t){t.preventDefault();var r=e(this);5==r.val()?e(".recharge-check-no").show():e(".recharge-check-no").hide()}),e("#recharge_money, #recharge_send").on("change",function(t){t.preventDefault(),e(".recharge-total-money").text(r.calculateRechargeMoney())}),e("#refresh_money, #refresh_send").on("change",function(t){t.preventDefault(),e(".refresh-total-money").text(r.calculateRefreshMoney())}),e(".recharge-card-submit").on("click",function(t){t.preventDefault();var r=e(this).button("loading"),n=e(".recharge-card-form"),a=n.serialize();return!("submitting"==n.attr("submitting")||!n.valid())&&(n.attr("submitting","submitting"),e.post("/member/memberCardCZ",a,function(t){n.attr("submitting",""),1==t.code?location.reload():(e.logConsole("会员卡充值失败",t.message),e.tipsWarningAlert("会员卡充值失败"))}),void r.button("reset"))}),e(".refresh-card-submit").on("click",function(t){t.preventDefault();var r=e(this).button("loading"),n=e(".refresh-card-form"),a=n.serialize();return!("submitting"==n.attr("submitting")||!n.valid())&&(n.attr("submitting","submitting"),e.post("/member/memberCardBuBan",a,function(t){n.attr("submitting",""),1==t.code?location.reload():(e.logConsole("会员补办失败",t.message),e.tipsWarningAlert("会员补办失败"))}),void r.button("reset"))}),e(".shengji-modal").on("click",function(r){r.preventDefault();var n=e('[name="cardTypeId"]').val();t(n)}),e("[name='cardTypeId']").on("change",function(r){r.preventDefault();var n=e(this).val();t(n)}),e(".upgrade-card-submit").on("click",function(t){t.preventDefault();var r=e(".upgrade-card-form"),n=r.serialize();return!("submitting"==r.attr("submitting")||!r.valid())&&(r.attr("submitting","submitting"),void e.post("member/memberCardUpLevel",n,function(t){r.attr("submitting",""),1==t.code?location.reload():(e.logConsole("会员升级失败",t.message),e.tipsWarningAlert("会员升级失败"))}))})}};t.init()}(jQuery);