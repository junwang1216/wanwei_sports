!function(t){var e={init:function(){this.initEvents(),this.bindPayEvents(),t(".money-num").text(this.calculateMoney())},calculateMoney:function(){var e=t(".goods-cart-list"),o=e.find(".good-count"),a=0;return o.each(function(e,o){var n=parseFloat(t(o).attr("data-money")),r=parseInt(t(o).val());a+=100*n*r}),(a/100).toFixed(2)},calculateShoppingMoney:function(e){t.post("/good/calculateShoppingMoney",e,function(e){var o=e.data;if(1==e.code){var a=o.presentPrice||o.originalPrice;t("#goods_paid_sum").val(a.toFixed(2))}else t.logConsole("订单计价失败",e.message),t.tipsWarningAlert("订单计价失败")})},bindPayEvents:function(){var e=this;t(".goods-buy-money").on("click",function(){var o=t(".cart-list"),a=[];o.find(".cart-item").each(function(e,o){a.push(t(o).attr("data-sid"))}),t("#goods_user_shoppingIds").val(a.join(","));var n=t("#goods_user_form"),r=n.serialize();e.calculateShoppingMoney(r)}),t("#goods_user_name").autosuggest({url:"/member/searchMember",method:"post",queryParamName:"search",dataCallback:function(e){var o=e.data,a=[];if(1==e.code){if(o&&o.members&&o.members.length>0){for(var n=0;n<o.members.length;n++)a.push({id:o.members[n].memberMobile,label:o.members[n].memberId,value:o.members[n].memberName+"("+o.members[n].cardTypeName+")"});return a}return t("#goods_user_memberId").val("0"),t("#goods_user_opType").val("2"),[]}return t.logConsole("搜索会员失败",e.message),t.tipsWarningAlert("搜索会员失败"),[]},onSelect:function(e){var o=e.data("label"),a=e.data("id"),n=e.data("value");t("#goods_user_memberId").val(o),t("#goods_user_mobile").val(a),t("#goods_user_opType").val("1"),t("#goods_user_name").val(n.replace(/\(.+\)/,""))}}),t("#goods_pay_order").on("click",function(e){function o(e){var o=t("#goods_user_form"),a=o.serialize();return!("submitting"===o.attr("submitting")||!o.valid())&&(o.attr("submitting","submitting"),void t.post("/good/saveOrder",a,function(a){var n=a.data;o.attr("submitting",""),1==a.code?(t("#goods_paid_order").val(n.orderId),e()):(t.logConsole("保存订单失败",a.message),t.tipsWarningAlert("保存订单失败"))}))}function a(){var e=t("#goods_paid_form"),o=e.serialize();return!("submitting"===e.attr("submitting")||!e.valid())&&(e.attr("submitting","submitting"),void t.post("/good/confirmOrder",o,function(o){e.attr("submitting",""),1==o.code?t.tipsSuccessAlert("支付订单成功！",function(){location.assign("/order/getOrderList?orderServiceTypes=300")}):(t.logConsole("支付订单失败",o.message),t.tipsWarningAlert("支付订单失败"))}))}e.preventDefault(),o(a)})},initEvents:function(){var e=this,o=t(".goods-cart-list");o.on("click",".goods-remove",function(e){e.preventDefault();var o=t(this);t.post("/good/deleteCart",{shoppingId:o.attr("data-sid")},function(e){1==e.code?location.reload():(t.logConsole("移除购物车失败",e.message),t.tipsWarningAlert("移除购物车失败"))})}),o.on("click",".goods-plus",function(o){o.preventDefault();var a=t(this),n=parseInt(a.parents(".input-group").find(".good-count").val());t.post("/good/addGoodsToCart",{goodId:a.attr("data-id"),amount:1},function(o){var r=a.parents(".input-group").find(".good-count");if(1==o.code){r.val(++n),t(".money-num").text(e.calculateMoney());var i=parseFloat(r.attr("data-money")),s=parseInt(r.val());a.parents(".cart-item").find(".good-total").text((i*s).toFixed(2)+"元")}else t.logConsole("增加数量失败",o.message),t.tipsWarningAlert("增加数量失败")})}),o.on("click",".goods-minus",function(o){o.preventDefault();var a=t(this),n=parseInt(a.parents(".input-group").find(".good-count").val());return!(n<=1)&&void t.post("/good/addGoodsToCart",{goodId:a.attr("data-id"),amount:-1},function(o){var r=a.parents(".input-group").find(".good-count");if(1==o.code){r.val(--n),t(".money-num").text(e.calculateMoney());var i=parseFloat(r.attr("data-money")),s=parseInt(r.val());a.parents(".cart-item").find(".good-total").text((i*s).toFixed(2)+"元")}else t.logConsole("减少数量失败",o.message),t.tipsWarningAlert("减少数量失败")})})}};e.init()}(jQuery);