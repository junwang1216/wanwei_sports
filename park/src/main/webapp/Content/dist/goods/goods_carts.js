!function(t){var e={init:function(){this.initEvents();var e=t("#zhifuModal");e.find(".goods-steps").steps({enableFinishButton:!1,enablePagination:!1,enableAllSteps:!1}),this.bindPayEvents(),t(".money-num").text(this.calculateMoney())},calculateMoney:function(){var e=t(".goods-cart-list"),o=e.find(".good-count"),a=0;return o.each(function(e,o){var n=parseFloat(t(o).attr("data-money")),i=parseInt(t(o).val());a+=100*n*i}),(a/100).toFixed(2)},calculateShoppingMoney:function(e){t.post("/good/calculateShoppingMoney",e,function(e){var o=e.data;1==e.code?t("#goods_paid_sum").val(o.presentPrice||o.originalPrice):alert(e.message||"订单计价失败，请稍后重试")})},bindPayEvents:function(){var e=this,o=t("#zhifuModal");t(".goods-buy-money").on("click",function(){var e=t(".cart-list"),o=[];e.find(".cart-item").each(function(e,a){o.push(t(a).attr("data-sid"))}),t("#goods_user_shoppingIds").val(o.join(","))}),t("#goods_user_name").autosuggest({url:"/member/searchMember",method:"post",queryParamName:"search",dataCallback:function(t){var e=t.data,o=[];if(1==t.code){if(e&&e.members&&e.members.length>0){for(var a=0;a<e.members.length;a++)o.push({id:e.members[a].memberMobile,label:e.members[a].memberId,value:e.members[a].memberName});return o}return[]}return alert("搜索会员失败, 请稍后重试"),[]},onSelect:function(e){var o=e.data("label"),a=e.data("id");t("#goods_user_mobile").val(a),t("#goods_user_memberId").val(o),t("#goods_user_opType").val("1")}}),t("#goods_user_pay").on("click",function(a){a.preventDefault();var n=t("#goods_user_form"),i=n.serialize();return!("submitting"===n.attr("submitting")||!n.valid())&&(n.attr("submitting","submitting"),t.post("/good/saveOrder",i,function(e){var a=e.data;n.attr("submitting",""),1==e.code?(o.find(".goods-steps").steps("next",1),t("#goods_paid_order").val(a.orderId)):alert(e.message||"保存订单失败，请稍后重试")}),void e.calculateShoppingMoney(i))}),t("#goods_paid_confirm").on("click",function(e){e.preventDefault();var o=t("#goods_paid_form"),a=o.serialize();return!("submitting"===o.attr("submitting")||!o.valid())&&(o.attr("submitting","submitting"),void t.post("/good/confirmOrder",a,function(t){o.attr("submitting",""),1==t.code?location.assign("/order/getOrderList?orderServiceTypes=300"):alert(t.message||"支付订单失败，请稍后重试")}))})},initEvents:function(){var e=this,o=t(".goods-cart-list");o.on("click",".goods-remove",function(e){e.preventDefault();var o=t(this);t.post("/good/deleteCart",{shoppingId:o.attr("data-sid")},function(t){1==t.code?location.reload():alert(t.message||"移除购物车失败, 请稍后重试")})}),o.on("click",".goods-plus",function(o){o.preventDefault();var a=t(this),n=parseInt(a.parents(".input-group").find(".good-count").val());t.post("/good/addGoodsToCart",{goodId:a.attr("data-id"),amount:1},function(o){1==o.code?(a.parents(".input-group").find(".good-count").val(++n),t(".money-num").text(e.calculateMoney())):alert(o.message||"增加数量失败, 请稍后重试")})}),o.on("click",".goods-minus",function(o){o.preventDefault();var a=t(this),n=parseInt(a.parents(".input-group").find(".good-count").val());return!(n<=1)&&void t.post("/good/addGoodsToCart",{goodId:a.attr("data-id"),amount:-1},function(o){1==o.code?(a.parents(".input-group").find(".good-count").val(--n),t(".money-num").text(e.calculateMoney())):alert(o.message||"减少数量失败, 请稍后重试")})})}};e.init()}(jQuery);