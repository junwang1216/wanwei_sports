!function(e){var t={init:function(){this.initEvents();var t=e("#zhifuModal");t.find(".goods-steps").steps({enableFinishButton:!1,enablePagination:!1,enableAllSteps:!1}),this.bindPayEvents(),e(".money-num").text(this.calculateMoney())},calculateMoney:function(){var t=e(".goods-cart-list"),o=t.find(".good-count"),a=0;return o.each(function(t,o){var n=parseFloat(e(o).attr("data-money")),r=parseInt(e(o).val());a+=100*n*r}),(a/100).toFixed(2)},calculateShoppingMoney:function(t){e.post("/good/calculateShoppingMoney",t,function(t){var o=t.data;1==t.code?e("#goods_paid_sum").val(o.presentPrice||o.originalPrice):alert(t.message||"订单计价失败，请稍后重试")})},bindPayEvents:function(){var t=this,o=e("#zhifuModal");e(".goods-buy-money").on("click",function(){var t=e(".cart-list"),o=[];t.find(".cart-item").each(function(t,a){o.push(e(a).attr("data-sid"))}),e("#goods_user_shoppingIds").val(o.join(","))}),e("#goods_user_mobile").autosuggest({url:"/member/searchMember",method:"post",queryParamName:"search",dataCallback:function(t){var o=t.data,a=[];if(1==t.code){if(o&&o.members&&o.members.length>0){for(var n=0;n<o.members.length;n++)a.push({id:o.members[n].memberMobile,label:o.members[n].memberId,value:o.members[n].memberName+"("+o.members[n].cardTypeName+")"});return a}return e("#goods_user_memberId").val("0"),e("#goods_user_opType").val("2"),e("#goods_user_name").val("散客"),[]}return alert("搜索会员失败, 请稍后重试"),[]},onSelect:function(t){var o=t.data("label"),a=t.data("id"),n=t.data("value");e("#goods_user_memberId").val(o),e("#goods_user_mobile").val(a),e("#goods_user_opType").val("1"),e("#goods_user_name").val(n.replace(/\(.+\)/,""))}}),e("#goods_user_pay").on("click",function(a){a.preventDefault();var n=e("#goods_user_form"),r=n.serialize();return!("submitting"===n.attr("submitting")||!n.valid())&&(n.attr("submitting","submitting"),e.post("/good/saveOrder",r,function(t){var a=t.data;n.attr("submitting",""),1==t.code?(o.find(".goods-steps").steps("next",1),e("#goods_paid_order").val(a.orderId)):alert(t.message||"保存订单失败，请稍后重试")}),void t.calculateShoppingMoney(r))}),e("#goods_paid_confirm").on("click",function(t){t.preventDefault();var o=e("#goods_paid_form"),a=o.serialize();return!("submitting"===o.attr("submitting")||!o.valid())&&(o.attr("submitting","submitting"),void e.post("/good/confirmOrder",a,function(e){o.attr("submitting",""),1==e.code?location.assign("/order/getOrderList?orderServiceTypes=300"):alert(e.message||"支付订单失败，请稍后重试")}))})},initEvents:function(){var t=this,o=e(".goods-cart-list");o.on("click",".goods-remove",function(t){t.preventDefault();var o=e(this);e.post("/good/deleteCart",{shoppingId:o.attr("data-sid")},function(e){1==e.code?location.reload():alert(e.message||"移除购物车失败, 请稍后重试")})}),o.on("click",".goods-plus",function(o){o.preventDefault();var a=e(this),n=parseInt(a.parents(".input-group").find(".good-count").val());e.post("/good/addGoodsToCart",{goodId:a.attr("data-id"),amount:1},function(o){1==o.code?(a.parents(".input-group").find(".good-count").val(++n),e(".money-num").text(t.calculateMoney())):alert(o.message||"增加数量失败, 请稍后重试")})}),o.on("click",".goods-minus",function(o){o.preventDefault();var a=e(this),n=parseInt(a.parents(".input-group").find(".good-count").val());return!(n<=1)&&void e.post("/good/addGoodsToCart",{goodId:a.attr("data-id"),amount:-1},function(o){1==o.code?(a.parents(".input-group").find(".good-count").val(--n),e(".money-num").text(t.calculateMoney())):alert(o.message||"减少数量失败, 请稍后重试")})})}};t.init()}(jQuery);