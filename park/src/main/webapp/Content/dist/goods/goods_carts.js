!function(o){var t={init:function(){this.initEvents();var t=o("#zhifuModal");t.find(".goods-steps").steps({enableFinishButton:!1,enablePagination:!1,enableAllSteps:!1}),this.bindPayEvents()},bindPayEvents:function(){var t=o("#zhifuModal"),s=o(".sc-ui-dialog-overlay"),e=o("#venue_goods_pay_form"),a=o("#venue_goods_paid_form"),n=o(".goods-buy-money"),i=!0;n.on("click",function(a){a.preventDefault(),o.getJSON("/goods/QueryGoodsCart",function(o){e.find("#pay_goods_amount").val(o.data.cartAmount)}),t.show(),s.show()}),t.on("click",".user-search",function(t){t.preventDefault();var s=o.dialog({content:"数据加载...",title:"load",width:"auto",height:"auto",lock:!0});o.getJSON("/users/Search",{name:o("#pay_goods_user_name").val().trim()},function(t){var e=t.data;200==t.status?(o("#pay_goods_user_class").val(e.memberlevel),o("#pay_goods_member_number").val(e.memberid),o("#pay_goods_member_name").val(e.membername),o("#pay_goods_user_mobile").val(e.phone)):alert(t.message),s.close()})}),t.on("click",".goods-pay",function(s){s.preventDefault();var n=e.serialize();e.find(".sc-submit-tips").hide().removeClass("text-success,text-danger"),i&&e.validate().form()&&(i=!1,o.post("/goods/BuyGoods",n,function(o){200==o.status?(e.find(".sc-submit-tips").show().html("提交成功!!").addClass("text-success"),t.find(".goods-steps").steps("next",1),a.find("#pay_goods_order_no").val(o.data.orderno),a.find("#pay_goods_real_money").val(o.data.paidamount)):e.find(".sc-submit-tips").show().html(o.message).addClass("text-danger"),i=!0}).fail(function(o){console.log(o),e.find(".sc-submit-tips").show().html("网络异常, 提交预订失败!!").addClass("text-danger"),i=!0}))}),t.on("click",".goods-pay-confirm",function(n){n.preventDefault();var d=a.serialize();a.find(".sc-submit-tips").hide().removeClass("text-success,text-danger"),i&&a.validate().form()&&(i=!1,o.post("/goods/submitGoodsConfirmBuy",d,function(o){200==o.status?(a.find(".sc-submit-tips").show().html("提交成功, 3秒后自动关闭!!").addClass("text-success"),setTimeout(function(){t.hide(),s.hide()},3e3)):e.find(".sc-submit-tips").show().html(o.message).addClass("text-danger"),i=!0}).fail(function(o){console.log(o),e.find(".sc-submit-tips").show().html("网络异常, 提交预订失败!!").addClass("text-danger"),i=!0}))}),t.find(".goods-steps-close").on("click",function(o){o.preventDefault(),t.hide(),s.hide()})},initEvents:function(){var t=o(".goods-cart-list");t.on("click",".goods-remove",function(t){t.preventDefault();var s=o(this);o.post("/good/deleteCart",{shoppingId:s.attr("data-sid")},function(o){1==o.code?location.reload():alert(o.message||"移除购物车失败, 请稍后重试")})}),t.on("click",".goods-plus",function(t){t.preventDefault();var s=o(this),e=parseInt(s.parents(".input-group").find(".good-count").val());o.post("/good/addGoodsToCart",{goodId:s.attr("data-id"),amount:1},function(o){1==o.code?s.parents(".input-group").find(".good-count").val(++e):alert(o.message||"增加数量失败, 请稍后重试")})}),t.on("click",".goods-minus",function(t){t.preventDefault();var s=o(this),e=parseInt(s.parents(".input-group").find(".good-count").val());return!(e<=1)&&void o.post("/good/addGoodsToCart",{goodId:s.attr("data-id"),amount:-1},function(o){1==o.code?s.parents(".input-group").find(".good-count").val(--e):alert(o.message||"减少数量失败, 请稍后重试")})})}};t.init()}(jQuery);