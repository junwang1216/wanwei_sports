!function(e){var t={opts:{URL:"/data/getMembersRegister",TPL:function(e){return"<tr><td>#CARD_TYPE_NAME#</td><td>#ALL_WEEKS#</td><td>#MONDAY#</td><td>#TUESDAY#</td><td>#WEDNESDAY#</td><td>#THURSDAY#</td><td>#FRIDAY#</td><td>#SATURDAY#</td><td>#SUNDAY#</td></tr>".replace("#CARD_TYPE_NAME#",e.cardTypeName).replace("#ALL_WEEKS#",e.allWeek).replace("#MONDAY#",e.Monday).replace("#TUESDAY#",e.Tuesday).replace("#WEDNESDAY#",e.Wednesday).replace("#THURSDAY#",e.Thursday).replace("#FRIDAY#",e.Friday).replace("#SATURDAY#",e.Saturday).replace("#SUNDAY#",e.Sunday)}},init:function(){this.initEvents(),e.datetimepicker.setLocale("zh"),e("#createTimeStart").datetimepicker({timepicker:!1,lang:"zh",format:"Y-m-d",defaultDate:new Date}),e("#createTimeEnd").datetimepicker({timepicker:!1,lang:"zh",format:"Y-m-d",defaultDate:new Date}),this.renderMemberStoredCharts(),this.renderMemberConsumeCharts(),this.getDataMembersCount()},initEvents:function(){var t=this;e(".data-filter").on("click",function(a){a.preventDefault();var r=e("#data_form").serialize();location.assign(t.opts.URL+"?"+r)})},renderMemberStoredCharts:function(){function t(e){for(var t=[],a=0;a<e.length;a++)t.push({name:e[a].cardTypeName,value:e[a].cardTypeTotal});return t}function a(e){return{backgroundColor:"#FFFFFF",color:["#59ADF3","#FF999A","#FFCC67"],tooltip:{trigger:"item",formatter:"{b}:{c}元"},grid:{left:60,top:10},xAxis:{type:"category",data:["最高","同比","当前"],axisLine:{onZero:!1,lineStyle:{width:3}},axisTick:{show:!1},axisLabel:{margin:10,textStyle:{fontWeight:"bold"}},offset:1},yAxis:{type:"value",axisTick:{show:!1},nameRotate:0,axisLine:{onZero:!1,lineStyle:{width:3}},axisLabel:{margin:10,textStyle:{fontWeight:"bold"},formatter:"{value}元"}},series:[{type:"bar",data:[36,20,24],itemStyle:{normal:{color:function(e){var t=["#59ADF3","#FF999A","#FFCC67"];return t[e.dataIndex]}}},barMaxWidth:"40px",label:{normal:{show:!0,position:"top",formatter:"{c}元"}}}]}}e.post("/data/getMembersRegister",{},function(e){var r=e.data;if(1==e.code){var n=t(r.memberCount),o=echarts.init(document.getElementById("member_stored_chart"));o.setOption(a(n))}})},renderMemberConsumeCharts:function(){function t(e){for(var t=[],a=0;a<e.length;a++)t.push({name:e[a].cardTypeName,value:e[a].cardTypeTotal});return t}function a(e){return{color:["#59ADF3","#FF999A","#FFCC67"],tooltip:{trigger:"item",formatter:"{b} <br/>金额：{c}元 <br/>比率：{d}%)"},toolbox:{show:!0,orient:"vertical",left:"right",top:"center",feature:{dataView:{readOnly:!1},restore:{},saveAsImage:{}}},series:[{name:"金额",type:"pie",radius:"90%",center:["50%","50%"],data:[{value:300,name:"场租"},{value:600,name:"商品"},{value:200,name:"余额"}],label:{normal:{position:"inner",formatter:"{b}\n{d}%",textStyle:{color:"#fff",fontWeight:"bold",fontSize:14}}},labelLine:{normal:{show:!1}}}]}}e.post("/data/getMembersRegister",{},function(e){var r=e.data;if(1==e.code){var n=t(r.memberCount),o=echarts.init(document.getElementById("member_consume_chart"));o.setOption(a(n))}})},renderMemberCountCharts:function(e,t,a){function r(e){for(var t=[],a=0;a<e.length;a++){var r={name:e[a].cardTypeName,type:"bar",data:[e[a].Monday,e[a].Tuesday,e[a].Wednesday,e[a].Thursday,e[a].Friday,e[a].Saturday,e[a].Sunday],stack:"数量",barMaxWidth:"40px",label:{normal:{show:!0,position:"insideTop",formatter:"{c}"}}};a==e.length-1&&(r.label.normal.position="top"),t.push(r)}return t}function n(e){for(var t=[],a=0;a<e.length;a++){var r={name:"合计",type:"line",data:[e[a].Monday,e[a].Tuesday,e[a].Wednesday,e[a].Thursday,e[a].Friday,e[a].Saturday,e[a].Sunday],stack:"数量",symbolSize:10,symbol:"circle",itemStyle:{normal:{barBorderRadius:0,label:{show:!0,position:"top",formatter:function(e){return e.value>0?e.value:""}}}}};t.push(r)}return t}var o=[];o=o.concat(r(e)),o=o.concat(n(t)),console.log(o);var i={backgroundColor:"#FFFFFF",color:["#59ADF3","#FF999A","#FFCC67","#44CC67"],tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},grid:{left:80,top:30},xAxis:{type:"category",data:["周一","周二","周三","周四","周五","周六","周日"],axisLine:{onZero:!1,lineStyle:{width:3}},axisTick:{show:!1},axisLabel:{margin:10,textStyle:{fontWeight:"bold"}},offset:1},yAxis:{type:"value"},series:o},d=echarts.init(document.getElementById("member_count_chart"));d.setOption(i)},getDataMembersCount:function(){var t=this,a=e(".data-members-count");e.post("/data/getMembersCountData",{},function(e){var r=e.data;if(1==e.code){for(var n=r.weeks,o=0;o<n.length;o++)a.append(t.opts.TPL(n[o]));for(var i=r.total,d=0;d<i.length;d++)a.append(t.opts.TPL(i[d]));t.renderMemberCountCharts(n,i,r.WEEKS),a.find("tr:last-child").addClass("bg-success")}})}};t.init()}(jQuery);