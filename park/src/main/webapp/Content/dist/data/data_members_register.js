!function(t){var e={opts:{URL:"/data/getMembersRegister",TPL:function(t){return"<tr><td>#CARD_TYPE_NAME#</td><td>#ALL_WEEKS#</td><td>#MONDAY#</td><td>#TUESDAY#</td><td>#WEDNESDAY#</td><td>#THURSDAY#</td><td>#FRIDAY#</td><td>#SATURDAY#</td><td>#SUNDAY#</td></tr>".replace("#CARD_TYPE_NAME#",t.cardTypeName).replace("#ALL_WEEKS#",t.allWeek).replace("#MONDAY#",t.Monday).replace("#TUESDAY#",t.Tuesday).replace("#WEDNESDAY#",t.Wednesday).replace("#THURSDAY#",t.Thursday).replace("#FRIDAY#",t.Friday).replace("#SATURDAY#",t.Saturday).replace("#SUNDAY#",t.Sunday)},conditions:{countNum:t("#count_num").val()}},init:function(){this.initEvents(),t.datetimepicker.setLocale("zh"),t("#createTimeStart").datetimepicker({timepicker:!1,lang:"zh",format:"Y-m-d",defaultDate:new Date}),t("#createTimeEnd").datetimepicker({timepicker:!1,lang:"zh",format:"Y-m-d",defaultDate:new Date}),this.getDataMembersStored(),this.getDataMembersConsumed(),this.getDataMembersCount()},initEvents:function(){var e=this;t(".data-filter").on("click",function(a){a.preventDefault();var r=t("#data_form").serialize();location.assign(e.opts.URL+"?"+r)})},renderMemberStoredCharts:function(t,e){function a(t){for(var e=[],a=0;a<t.length-1;a++){t[a].data.splice(0,0,t[a].realAmountSum);var r={name:t[a].cardTypeName,type:"bar",data:t[a].data,stack:"数量",barMaxWidth:"40px",label:{normal:{show:!1,position:"insideTop",formatter:function(t){return t.value>0?t.value:""}}}};a==t.length-1&&(r.label.normal.position="top"),e.push(r)}return e}function r(t){for(var e=[],a=t.length-1;a<t.length;a++){t[a].data.splice(0,0,t[a].realAmountSum);var r={name:t[a].cardTypeName,type:"line",data:t[a].data,stack:"数量",symbolSize:10,symbol:"circle",itemStyle:{normal:{barBorderRadius:0,label:{show:!0,position:"top",formatter:function(t){return t.value>0?t.value:""}}}}};e.push(r)}return e}var o=[];o=o.concat(a(e)),o=o.concat(r(e));var n={backgroundColor:"#FFFFFF",color:["#59ADF3","#FF999A","#FFCC67","#44CC67"],tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},grid:{left:80,top:30},xAxis:{type:"category",data:t,axisLine:{onZero:!1,lineStyle:{width:3}},axisTick:{show:!1},axisLabel:{margin:10,textStyle:{fontWeight:"bold"}},offset:1},yAxis:{type:"value"},series:o},i=echarts.init(document.getElementById("member_stored_chart"));i.setOption(n)},renderMemberStoredCompareCharts:function(t,e){function a(){return{backgroundColor:"#FFFFFF",color:["#59ADF3","#FF999A","#FFCC67"],tooltip:{trigger:"item",formatter:"{b}:{c}"},grid:{left:60,top:20},xAxis:{type:"category",data:["最高","同比","当前"],axisLine:{onZero:!1,lineStyle:{width:3}},axisTick:{show:!1},axisLabel:{margin:10,textStyle:{fontWeight:"bold"}},offset:1},yAxis:{type:"value",axisTick:{show:!1},nameRotate:0,axisLine:{onZero:!1,lineStyle:{width:3}},axisLabel:{margin:10,textStyle:{fontWeight:"bold"},formatter:"{value}"}},series:[{type:"bar",data:[30,e[e.length-1].count,t[t.length-1].count],itemStyle:{normal:{color:function(t){var e=["#59ADF3","#FF999A","#FFCC67"];return e[t.dataIndex]}}},barMaxWidth:"40px",label:{normal:{show:!0,position:"top",formatter:"{c}"}}}]}}var r=echarts.init(document.getElementById("member_stored_compared_chart"));r.setOption(a())},getDataMembersStored:function(){var e=this,a=t(".data-members-count");t.post("/data/getMembersStoredData",e.opts.conditions,function(t){var r=t.data;if(1==t.code){var o=r.current;e.renderMemberStoredCharts(o.titleList,o.list),a.find("tr:last-child").addClass("bg-success")}})},renderMemberConsumedCharts:function(t){var e=t[t.length-1],a={color:["#59ADF3","#FF999A","#FFCC67"],tooltip:{trigger:"item",formatter:"{b} <br/>金额：{c}元 <br/>比率：{d}%)"},toolbox:{show:!1,orient:"vertical",left:"right",top:"center",feature:{dataView:{readOnly:!1},restore:{},saveAsImage:{}}},series:[{name:"金额",type:"pie",radius:"90%",center:["50%","50%"],data:[{value:e.siteXF,name:"场租"},{value:e.goodsXF,name:"商品"},{value:e.cardBalance,name:"余额"}],label:{normal:{position:"inner",formatter:"{b}\n{d}%",textStyle:{color:"#fff",fontWeight:"bold",fontSize:14}}},labelLine:{normal:{show:!1}}}]},r=echarts.init(document.getElementById("member_consume_chart"));r.setOption(a)},getDataMembersConsumed:function(){var e=this,a=t(".data-members-count");t.post("/data/getMembersConsumedData",e.opts.conditions,function(t){var r=t.data;if(1==t.code){var o=r.current;e.renderMemberConsumedCharts(o.list),a.find("tr:last-child").addClass("bg-success")}})},renderMemberCountCharts:function(t,e){function a(t){for(var e=[],a=0;a<t.length-1;a++){t[a].data.splice(0,0,t[a].count);var r={name:t[a].cardTypeName,type:"bar",data:t[a].data,stack:"数量",barMaxWidth:"40px",label:{normal:{show:!1,position:"insideTop",formatter:function(t){return t.value>0?t.value:""}}}};a==t.length-1&&(r.label.normal.position="top"),e.push(r)}return e}function r(t){for(var e=[],a=t.length-1;a<t.length;a++){t[a].data.splice(0,0,t[a].count);var r={name:t[a].cardTypeName,type:"line",data:t[a].data,stack:"数量",symbolSize:10,symbol:"circle",itemStyle:{normal:{barBorderRadius:0,label:{show:!0,position:"top",formatter:function(t){return t.value>0?t.value:""}}}}};e.push(r)}return e}var o=[];o=o.concat(a(e)),o=o.concat(r(e));var n={backgroundColor:"#FFFFFF",color:["#59ADF3","#FF999A","#FFCC67","#44CC67"],tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},grid:{left:80,top:30},xAxis:{type:"category",data:t,axisLine:{onZero:!1,lineStyle:{width:3}},axisTick:{show:!1},axisLabel:{margin:10,textStyle:{fontWeight:"bold"}},offset:1},yAxis:{type:"value"},series:o},i=echarts.init(document.getElementById("member_count_chart"));i.setOption(n)},renderMemberCountCompareCharts:function(t,e){function a(){return{backgroundColor:"#FFFFFF",color:["#59ADF3","#FF999A","#FFCC67"],tooltip:{trigger:"item",formatter:"{b}:{c}"},grid:{left:60,top:20},xAxis:{type:"category",data:["最高","同比","当前"],axisLine:{onZero:!1,lineStyle:{width:3}},axisTick:{show:!1},axisLabel:{margin:10,textStyle:{fontWeight:"bold"}},offset:1},yAxis:{type:"value",axisTick:{show:!1},nameRotate:0,axisLine:{onZero:!1,lineStyle:{width:3}},axisLabel:{margin:10,textStyle:{fontWeight:"bold"},formatter:"{value}"}},series:[{type:"bar",data:[30,e[e.length-1].count,t[t.length-1].count],itemStyle:{normal:{color:function(t){var e=["#59ADF3","#FF999A","#FFCC67"];return e[t.dataIndex]}}},barMaxWidth:"40px",label:{normal:{show:!0,position:"top",formatter:"{c}"}}}]}}var r=echarts.init(document.getElementById("member_count_compare_chart"));r.setOption(a())},getDataMembersCount:function(){var e=this,a=t(".data-members-count");t.post("/data/getMembersCountData",e.opts.conditions,function(t){var r=t.data;if(1==t.code){var o=r.current;e.renderMemberCountCharts(o.titleList,o.list),a.find("tr:last-child").addClass("bg-success")}})}};e.init()}(jQuery);