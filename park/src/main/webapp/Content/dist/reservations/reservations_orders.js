!function(e){var r={opts:{URL:"/order/getOrderList?orderServiceTypes=100,200"},init:function(){this.initEvents(),this.changePaidMoney()},initEvents:function(){var r=this;e(".orders-filter").on("click",function(a){a.preventDefault();var t=e("#orders_filter_form").serialize();location.assign(r.opts.URL+"&"+t)}),e(".page-first, .page-prev, .page-index, .page-next, .page-last").on("click",function(a){a.preventDefault();var t=location.search,i=e(this).attr("data-index");t?t.indexOf("page=")==-1?location.assign(r.opts.URL+"&"+t+"&page="+i):location.assign(r.opts.URL+"&"+t.replace(/(page=)\d+/,"$1"+i)):location.assign(r.opts.URL+"&page="+i)}),e(".order-cancel").on("click",function(r){r.preventDefault();var a={orderId:e(this).attr("data-id")};return"working"!=e(this).attr("working")&&(e(this).attr("working","working"),void e.post("/order/cancelOrder",a,function(r){e(this).attr("working",""),1==r.code?location.reload():(e.logConsole("取消订单失败",r.message),e.tipsWarningAlert("取消订单失败"))}))}),e(".order-delete").on("click",function(r){r.preventDefault();var a={orderId:e(this).attr("data-id")};return"working"!=e(this).attr("working")&&(e(this).attr("working","working"),void e.post("/order/deleteOrder",a,function(r){e(this).attr("working",""),1==r.code?location.reload():(e.logConsole("取消订单失败",r.message),e.tipsWarningAlert("取消订单失败"))}))}),e(".order-pay").on("click",function(a){a.preventDefault();var t={orderId:e(this).attr("data-id"),memberId:e(this).attr("data-member")};return"working"!=e(this).attr("working")&&(e(this).attr("working","working"),void e.post("/order/getOrderToPay",t,function(a){e(this).attr("working","");var i=a.data;1==a.code?(e("#pay_modal").modal({backdrop:!1,show:!0}),e("#reservations_paid_orderSumCount").val(i.sumNums),e("#reservations_paid_orderSumPrice").val(i.originalPrice),e("#reservations_paid_payCount").val(i.sumNums),e("#reservations_paid_paySumPrice").val(i.originalPrice),e("#reservations_paid_money").val(i.originalPrice),r.queryMemberBalance(t.memberId)):(e.logConsole("查询订单支付失败",a.message),e.tipsWarningAlert("查询订单支付失败"))}))}),e(".reservations-pay-confirm").on("click",function(r){r.preventDefault();var a=e("#reservations_paid_form"),t=a.serialize();return!("submitting"==a.attr("submitting")||!a.valid())&&(a.attr("submitting","submitting"),void e.post("/site/confirmOrder",t,function(r){a.attr("submitting",""),1==r.code?(e("#pay_modal").modal("hide"),location.reload()):(e.logConsole("确认订单失败",r.message),e.tipsWarningAlert("确认订单失败"))}))})},queryMemberBalance:function(r){return r?void e.post("/member/memberDetail",{memberId:r},function(r){var a=r.data,t=e("#reservations_paid_money").val();1==r.code?(e("#reservations_paid_balance").val(a.cardBalance),a.cardBalance>=t?e("#reservations_paid_money").val("0.00"):e("#reservations_paid_money").val(t-a.cardBalance)):(e.logConsole("会员余额查询失败",r.message),e.tipsWarningAlert("会员余额查询失败"))}):void e("#reservations_paid_balance").val("您还不是会员")},changePaidMoney:function(){e("#reservations_paid_paySumPrice").on("change",function(r){r.preventDefault();var a=e("#reservations_paid_balance").val(),t=e(this).val();a=parseFloat(a).toFixed(2),t=parseFloat(t).toFixed(2),a>=t?e("#reservations_paid_money").val("0.00"):e("#reservations_paid_money").val(t-a)})}};r.init()}(jQuery);