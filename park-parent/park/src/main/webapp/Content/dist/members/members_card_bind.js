!function(e){var t={opts:{ToURL:"/member/memberList"},init:function(){e.post("/member/getMemberCarType",{cardTypeId:e('[name="cardTypeId"]').val()},function(t){var a=t.data;1==t.code?(e('[name="cardTypeMoney"]').val(a.cardTypeMoney||"0.00"),e('[name="cardDeadline"]').val(a.cardTypeMonth>0?a.cardDeadline:"无限制"),e('[name="cardDeposit"]').val(a.cardDeposit||"0.00")):(e.logConsole("会员类别详情查询失败",t.message),e.tipsWarningAlert("会员类别详情查询失败"))}),this.initEvents()},calculateMoney:function(){var t=e("#recharge_money"),a=e("#recharge_send"),i=e("#recharge_type_money"),n=e("#recharge_type_deposit"),r=parseFloat(t.val()||"0.00"),o=parseFloat(a.val()||"0.00"),c=parseFloat(i.val()),m=parseFloat(n.val());return{total:(r+o-c-m).toFixed(2),pay:(r+c+m).toFixed(2)}},initEvents:function(){var t=this;e(".genxin-submit").on("click",function(t){t.preventDefault();var a=e("#member_form"),i=a.serialize();return!("submitting"==a.attr("submitting")||!a.valid())&&(a.attr("submitting","submitting"),void e.post("/member/updateMemberName",i,function(t){a.attr("submitting",""),1==t.code?e.tipsSuccessAlert("会员信息更新成功!"):(e.logConsole("会员信息更新失败",t.message),e.tipsWarningAlert("会员信息更新失败"))}))}),e("#recharge_type").on("change",function(t){t.preventDefault();var a=e(this),i=e(".recharge-check-no");a.val()==i.attr("data-value")?i.show():i.hide()}),e("#recharge_money, #recharge_send").on("change",function(a){a.preventDefault(),e(".total-money").text(t.calculateMoney().total),e(".pay-money").text(t.calculateMoney().pay)}),e(".register-recahrge").on("click",function(t){t.preventDefault();var a=e("#member_card_form"),i=a.serialize();return!("submitting"==a.attr("submitting")||!a.valid())&&(a.attr("submitting","submitting"),void e.post("/member/saveMemberCar",i,function(t){a.attr("submitting",""),1==t.code?(e("#confirm_modal").modal({backdrop:!1,show:!0}),e.each(t.data,function(t,a){e("#member_card_ticket_form").find("input[name='"+t+"']").val(a)}),e("#member_card_ticket_form").find("#ticket_header").val(""),e("#member_card_ticket_form").find("#ticket_money").val(""),e("#member_card_ticket_form").find("#ticket_content").val(""),e("#member_card_ticket_form").find("#invoice_no").val(t.data.balanceNo)):(e.logConsole("会员绑卡失败",t.message),e.tipsWarningAlert("会员绑卡失败"))}))}),e("#is_print_ticket").on("change",function(t){t.preventDefault();var a=e(this).prop("checked");a?e(".is-show-ticket").show():e(".is-show-ticket").hide()}),e(".print-ticket").on("click",function(a){if(a.preventDefault(),!e("#is_print_ticket").prop("checked"))return location.assign(t.opts.ToURL),e("#confirm_modal").modal("hide"),!1;var i=e("#member_card_ticket_form"),n=i.serialize();return!("submitting"==i.attr("submitting")||!i.valid())&&(i.attr("submitting","submitting"),void e.post("/member/saveInvoice",n,function(a){i.attr("submitting",""),1==a.code?(location.assign(t.opts.ToURL),e("#confirm_modal").modal("hide")):(e.logConsole("发票登记失败",a.message),e.tipsWarningAlert("发票登记失败"))}))})}};t.init()}(jQuery);