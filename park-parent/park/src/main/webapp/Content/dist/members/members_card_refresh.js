!function(e){var r={init:function(){this.initEvents(),this.getNewCardNo()},getNewCardNo:function(){e.post("member/getNewCardNo",function(r){var t=r.data;1==r.code?e("#newCardNo").val(t.newCardNo):(e.logConsole("新会员卡号生成失败",r.message),e.tipsWarningAlert("新会员卡号生成失败"))},"json")},calculateRefreshMoney:function(){var r=e("#refresh_money"),t=e("#refresh_send"),a=parseFloat(r.val()||"0.00"),n=parseFloat(t.val()||"0.00");return{total:n.toFixed(2),pay:a.toFixed(2)}},initEvents:function(){var r=this;e("#keywords").autosuggest({url:"/member/searchMember",method:"post",queryParamName:"search",dataCallback:function(r){var t=r.data,a=[];if(1==r.code){if(t&&t.members&&t.members.length>0){for(var n=0;n<t.members.length;n++)a.push({id:t.members[n].memberId,label:t.members[n].cardNo,value:t.members[n].memberName+"("+t.members[n].memberMobile+","+t.members[n].cardNo+")"});return a}return e.tipsWarningAlert("没有搜索到会员"),[]}return e.logConsole("搜索会员失败",r.message),e.tipsWarningAlert("搜索会员失败"),[]},onSelect:function(r){var t=r.data("label");e("#card_no").val(t),location.assign("/member/getMembersCardRefresh?cardNo="+t)}}),e(".member-card-filter").on("click",function(r){r.preventDefault();var t=e("#member_card_form"),a=t.serialize();return!!t.valid()&&void e.post("member/searchMember",a,function(r){var t=r.data;1==r.code?t&&t.members&&t.members.length>0?location.assign("/member/getMembersCardRefresh?cardNo="+t.members[0].cardNo):e.tipsWarningAlert("没有搜索到会员"):(e.logConsole("搜索会员失败",r.message),e.tipsWarningAlert("搜索会员失败"))})}),e("#refresh_money, #refresh_send").on("change",function(t){t.preventDefault(),e(".refresh-total-money").text(r.calculateRefreshMoney().total),e(".refresh-pay-money").text(r.calculateRefreshMoney().pay)}),e(".refresh-card-submit").on("click",function(r){r.preventDefault();var t=e("#refresh_card_form"),a=t.serialize();return""===e("#refresh_cardId").val()?(e.tipsWarningAlert("请先选择会员卡"),!1):!("submitting"==t.attr("submitting")||!t.valid())&&(t.attr("submitting","submitting"),void e.post("/member/memberCardBuBan",a,function(r){t.attr("submitting",""),1==r.code?location.reload():(e.logConsole("会员补办失败",r.message),e.tipsWarningAlert("会员补办失败"))}))})}};r.init()}(jQuery);